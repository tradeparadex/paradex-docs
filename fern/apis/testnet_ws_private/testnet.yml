asyncapi: 2.6.0
info:
  title: WebSocket channels
  version: ''
  description: |
    Channels that can be subscribed to get real-time updates by
    using <a href="#subscribe">subscribe</a>.
channels:
  /v1:
    description: 'Private websocket channel to receive details of fills for a specific account'
    bindings:
      ws: {}
    publish:
      summary: 'Publish to private websocket channel to receive details of fills for specific account'
      operationId: publishFills
      message:
        oneOf:
          - $ref: '#/components/messages/Authorize'
          - $ref: '#/components/messages/FillsSubscribe'
          - $ref: '#/components/messages/OrdersMarketSymbolSubscribe'
    subscribe:
      summary: 'Subscribe to private websocket channel to receive details of fills for specific account'
      operationId: subscribeFills
      message:
        oneOf:
          - $ref: '#/components/messages/Fill'
          - $ref: '#/components/messages/OrderMarketSymbol'

components:
  messages:
    Authorize:
      name: authorize
      title: Authorize
      messageId: Authorize
      summary: 'Authorization message'
      payload:
        type: object
        title: Authorize
        required:
          - id
          - jsonrpc
          - method
          - params
        properties:
          id:
            $ref: '#/components/schemas/id'
          jsonrpc:
            $ref: '#/components/schemas/jsonrpc'
          method:
            description: 'Method to call'
            enum:
              - auth
          params:
            description: 'Parameters to pass to the method'
            type: object
            required:
              - bearer
            properties:
              bearer:
                type: string
                description: 'API Key'

    FillsSubscribe:
      name: fills
      title: Fills
      messageId: FillsSubscribe
      summary: 'Fill Details (Requires Authorization)'
      payload:
        type: object
        title: Fills
        required:
          - id
          - jsonrpc
          - method
          - params
        properties:
          id:
            $ref: '#/components/schemas/id'
          jsonrpc:
            $ref: '#/components/schemas/jsonrpc'
          method:
            description: 'Method to call'
            enum:
              - subscribe
          params:
            description: 'Parameters to pass to the method'
            type: object
            required:
              - channel
            properties:
              channel:
                description: 'fills.{market_symbol}'
                enum:
                  - fills.ETH-USD-PERP
                  - fills.BTC-USD-PERP
    
    Fill:
      name: fill
      title: Fill
      payload:
        type: object
        title: Fill
        description: 'Fill Details'
        additionalProperties: false
        properties:
          client_id:
            description: Unique client assigned ID for the order.
            type: string
            example: 'x1234'
          created_at:
            description: Fill time in milliseconds.
            type: integer
            example: 1696291200000
          fee:
            description: Fee paid by the user in fee_currency
            type: string
            example: '7.56'
          fee_currency:
            description: Asset that fee is charged in
            type: string
            enum:
              - USDC
          id:
            description: Unique ID of the fill
            type: string
            example: '8615262148007718462'
          liquidity:
            description: Maker or Taker
            type: string
            enum:
              - TAKER
              - MAKER
          market:
            $ref: '#/components/schemas/properties/MarketSymbol'
          order_id:
            description: Order ID assigned by exchange
            type: string
            example: '1681462103821101699438490000'
          price:
            description: Price at which order was filled
            type: string
            example: '30000.12'
          side:
            $ref: '#/components/schemas/properties/OrderSide'
          size:
            description: Size of the fill
            type: string
            example: '0.5'
          remaining_size:
            description: Remaining size of the order
            type: string
            example: '0.7'
          seq_no:
            description: Sequence number of the fill
            type: integer
            example: 20784
          fill_type:
            description: Type of fill
            type: string
            enum:
              - FILL
              - LIQUIDATION

    OrdersMarketSymbolSubscribe:
      name: orders_market_symbol
      title: 'Orders Market Symbol'
      messageId: OrdersMarketSymbolSubscribe
      summary: 'Orders Details (Requires Authorization)'
      payload:
        type: object
        title: OrdersMarketSymbol
        required:
          - id
          - jsonrpc
          - method
          - params
        properties:
          id:
            $ref: '#/components/schemas/id'
          jsonrpc:
            $ref: '#/components/schemas/jsonrpc'
          method:
            description: 'Method to call'
            enum:
              - subscribe
          params:
            description: 'Parameters to pass to the method'
            type: object
            required:
              - channel
            properties:
              channel:
                description: 'orders.{market_symbol}'
                enum:
                  - orders.ETH-USD-PERP
                  - orders.BTC-USD-PERP

    OrderMarketSymbol:
      name: order
      title: Order (Private)
      payload:
        type: object
        title: Order
        additionalProperties: false
        properties:
          account:
            description: Account identifier (user's account address)
            type: string
            example: 0x4638e3041366aa71720be63e32e53e1223316c7f0d56f7aa617542ed1e7512x
          cancel_reason:
            description: Reason for order cancellation if it was closed by cancel
            type: string
            enum:
              - USER_CANCELED
              - NOT_ENOUGH_MARGIN
              - EMPTY_MARKET
              - POST_ONLY_WOULD_CROSS
              - REMAINING_IOC_CANCEL
              - UNEXPECTED_FAILURE
              - DELEVERAGE
              - IN_LIQUIDATION
              - SELF_TRADE
              - ASSET_UNAVAILABLE
              - ASSET_EXPIRED
              - MARKET_NOT_OPEN
              - ORDER_TYPE_INVALID
              - PRICE_NOT_AVAILABLE
              - EXPIRED
              - PRICE_OUTSIDE_BANDS
              - TIMEOUT
              - ORDER_EXCEEDS_POSITION_LIMIT
              - REDUCE_ONLY_WILL_INCREASE
          client_id:
            description: Client id passed on order creation
            type: string
            example: x1234
          created_at:
            description: Order creation time in milliseconds
            type: integer
            example: 1696291200000
          id:
            description: Unique order identifier assigned by exchange
            type: string
            example: '123456'
          instruction:
            description: Order instruction type, either "GTC", "IOC", or "POST_ONLY"
            type: string
            enum:
              - GTC
              - POST_ONLY
              - IOC
          last_updated_at:
            description: Order last update time in milliseconds.  No changes once status=CLOSED
            type: integer
            example: 1696291200000
          market:
            $ref: '#/components/schemas/properties/MarketSymbol'
          price:
            description: Order limit price
            type: string
            example: '26000.5'
          remaining_size:
            description: Remaining size of the order
            type: string
            example: '0'
          side:
            $ref: '#/components/schemas/properties/OrderSide'
          size:
            description: Order size
            type: string
            example: '0.05'
          status:
            description: Order status
            type: string
            enum:
              - NEW
              - OPEN
              - CLOSED
          timestamp:
            description: Order signature timestamp
            $ref: '#/components/schemas/properties/timestamp'
          type:
            description: Order type
            type: string
            enum:
              - MARKET
              - LIMIT
              - STOP_MARKET
              - STOP_LIMIT
          seq_no:
            description: Sequence number of the order updates. WebSocket and REST responses use independently generated seq_no per event.
            type: integer
            example: 20784
          avg_fill_price:
            description: Average fill price of the order
            type: string
            example: '26000'
          received_at:
            description: Order received time in milliseconds
            type: integer
            example: 1696291200000
          published_at:
            description: Order published time in milliseconds
            type: integer
            example: 1696291200000
          flags:
            description: Order flags
            type: array
            items:
              type: string
          trigger_price:
            description: Trigger price for stop order
            type: string
            example: '26000.5'

  parameters:
    market_symbol:
      description: Symbol of the market (any open market returned by `GET /markets`)
      schema:
        type: string
    market_symbol_or_all:
      description: Either the symbol of the market (any open market returned by `GET /markets`) or `"ALL"` to subscribe for updates to all markets
      schema:
        type: string
    program_name:
      description: Name of the program to subscribe to for updates
      schema:
        type: string
        enum:
          - Maker
          - Fee
    refresh_rate:
      description: Rate of sending updates
      schema:
        type: string
        enum:
          - 50ms
          - 100ms
  schemas:
    properties:
      MarketSymbol:
        type: string
        description: Symbol of the market
      OrderSide:
        type: string
        description: Order side
        enum:
          - BUY
          - SELL
      timestamp:
        type: number
        format: Unix Timestamp (ms)
        example: 1681462770114
    deltas:
      type: object
      properties:
        side:
          type: string
          enum:
            - BUY
            - SELL
        price:
          type: string
          minimum: 0
          example: 1234.12
        size:
          type: string
          minimum: 0
          example: 12.12
    jsonrpc:
      description: 'JSON-RPC version'
      type: string
      enum:
        - '2.0'
    id:
      description: 'ID of the message'
      type: number
      example: 1